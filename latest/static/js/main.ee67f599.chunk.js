(window.webpackJsonpairglow=window.webpackJsonpairglow||[]).push([[0],{26:function(e,t,a){e.exports=a(42)},32:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(25),i=a(1),o=a.n(i),c=a(3),s=a(8),l=a(15),u=a(14),m=a(2),h=a(4),d=a(16),g=(a(20),a(32),a(17)),f=a(5);function p(e){var t=function(e){for(var t=e.length/4,a=new Float32Array(t),n=new Float32Array(t),r=new Float32Array(t),i=new Float32Array(t),o=0;o<t;o++)a[o]=e[4*o],n[o]=e[4*o+1],r[o]=e[4*o+2],i[o]=e[4*o+3];return[a,n,r,i]}(e.data),a=Object(g.a)(t,4),n=a[0],r=a[1],i=a[2],o=a[3],c=e.width,s=e.height;return[Object(f.rfft2d)(n,c,s),Object(f.rfft2d)(r,c,s),Object(f.rfft2d)(i,c,s),o]}function v(e,t,a){var n=Object(g.a)(e,4),r=n[0],i=n[1],o=n[2],c=n[3],s=function(e){for(var t=Object(g.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3],o=a.length,c=new Uint8ClampedArray(4*o),s=0;s<o;s++)c[4*s]=a[s],c[4*s+1]=n[s],c[4*s+2]=r[s],c[4*s+3]=i[s];return c}([Object(f.irfft2d)(r,t,a),Object(f.irfft2d)(i,t,a),Object(f.irfft2d)(o,t,a),c]);return new ImageData(s,t,a)}function w(e,t,a){var n=e[t];e[t]=e[a],e[a]=n}function b(){var e=window.location.pathname.split("/");if(e.length>1){var t=e[1];if("latest"===t)return t;if(t.startsWith("v")){var a=t.slice(1);if(!"0.1.0".startsWith(a))return"???"}}return"0.1.0"}function y(e,t){if("latest"===e)return-1;if("latest"===t)return 1;for(var a=/^(\d+)\.(\d+)\.(\d+)$/,n=e.match(a),r=t.match(a),i=0,o=[1,2,3];i<o.length;i++){var c=o[i],s=parseInt(n[c]),l=parseInt(r[c]);if(s>l)return-1;if(s<l)return 1}return 0}var E=function(){function e(t){Object(s.a)(this,e),this.s={a:0,b:0,c:0,d:0},this.setState(t)}return Object(h.a)(e,null,[{key:"hashCode",value:function(e){var t=0;if(0===e.length)return t;for(var a=0;a<e.length;a++){t=(t<<5)-t+e.charCodeAt(a),t%=4294967296}return t}},{key:"makeSeed",value:function(t){return"number"===typeof t?t%4294967296:"string"===typeof t?e.hashCode(t)%4294967296:Date.now()%4294967296}},{key:"splitMix32",value:function(e){e[0]=(e[0]+2654435769)%4294967296;var t=e[0];return((t=3266489909*((t=2246822507*(t^t>>>16)%4294967296)^t>>>13)%4294967296)^t>>>16)%4294967296}}]),Object(h.a)(e,[{key:"setState",value:function(t){if(void 0===t||"object"!==typeof t){var a=[e.makeSeed(t)];t={a:e.splitMix32(a),b:e.splitMix32(a),c:e.splitMix32(a),d:e.splitMix32(a)}}this.s=t}},{key:"getState",value:function(){return this.s}},{key:"getPermutation",value:function(e){for(var t=Array.from({length:e},(function(e,t){return t}));e>1;){w(t,e-=1,Math.floor(this.random()*e))}return t}},{key:"random",value:function(){var e=this.s,t=e.b<<9,a=5*e.a;return a=9*(a<<7|a>>>25),e.c^=e.a,e.d^=e.b,e.b^=e.c,e.a^=e.d,e.c^=t,e.d=e.d<<11|e.d>>>21,(a>>>0)/4294967296}}]),e}();function k(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=document.createElement("canvas"),i=e.width,o=e.height;r.width=i,r.height=o;var c=r.getContext("2d");return function(e,t,a,n,r){var i=Math.floor(a.height/2/n.height),o=Math.floor(a.width/n.width);if(0===i||0===o)throw new Error("Secret image is too large: use an image whose width <= ".concat(a.width," and")+"height <= ".concat(Math.floor(a.height/2)));for(var c=n.width,s=n.height,l=0;l<i;++l)for(var u=0;u<o;++u){if((r-=1)<0)return;t.putImageData(n,u*c,l*s)}}(0,c,e,t,n),function(e,t){var a=Math.floor(e.data.length/4),n=t.getPermutation(Math.floor(a/2)),r=new ImageData(e.data.slice(),e.width,e.height);return n.forEach((function(t,n){for(var i=0;i<4;++i)r.data[4*n+i]=e.data[4*t+i],r.data[4*(a-1-n)+i]=e.data[4*t+i]})),r}(c.getImageData(0,0,i,o),a)}function N(e,t,a,n,r,i){return x.apply(this,arguments)}function x(){return(x=Object(c.a)(o.a.mark((function e(t,a,n,r,i,c){var s,l,u,m,h,d,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(0,"Initializing");case 2:if(""!==(n=n.trim())){e.next=5;break}throw new Error("Secret key cannot be empty");case 5:return e.next=7,c(5,"Making watermarks");case 7:return s=new E(n),l=k(t,a,s,r),e.next=11,c(20,"Calculating the frequency domain of original image");case 11:return u=p(t),e.next=14,c(40,"Calculating the frequency domain of watermarks");case 14:return m=p(l),e.next=17,c(60,"Calculating the frequency domain of encoded image");case 17:return h=function(e){return function(t,a){return t+m[e][a]*i}},d=[u[0].map(h(0)),u[1].map(h(1)),u[2].map(h(2)),u[3]],e.next=21,c(80,"Calculating the resulting image");case 21:return g=v(d,t.width,t.height),e.next=24,c(100,"Finished!","success");case 24:return e.abrupt("return",g);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){var a=Math.floor(e.data.length/4),n=t.getPermutation(Math.floor(a/2)),r=new ImageData(e.data.slice(),e.width,e.height);return n.forEach((function(t,n){for(var i=0;i<4;++i)r.data[4*t+i]=e.data[4*n+i],r.data[4*(a-1-t)+i]=e.data[4*(a-1-n)+i]})),r}function j(e,t,a,n,r){return O.apply(this,arguments)}function O(){return(O=Object(c.a)(o.a.mark((function e(t,a,n,r,i){var c,s,l,u,m,h,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(0,"Initializing");case 2:if(""!==(n=n.trim())){e.next=5;break}throw new Error("Secret key cannot be empty");case 5:return e.next=7,i(5,"Calculating the frequency domain of original image");case 7:return c=p(t),e.next=10,i(20,"Calculating the frequency domain of encoded image");case 10:return s=p(a),e.next=13,i(40,"Calculating the frequency domain of watermarks");case 13:return l=function(e){return function(t,a){return(s[e][a]-t)/r}},u=[c[0].map(l(0)),c[1].map(l(1)),c[2].map(l(2)),c[3]],e.next=17,i(60,"Calculating the watermarks image");case 17:return m=v(u,t.width,t.height),e.next=20,i(80,"Calculating the resulting image");case 20:return h=new E(n),d=C(m,h),e.next=24,i(100,"Finished!","success");case 24:return e.abrupt("return",d);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(40);var D=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onVersionSelectedHandler=a.onVersionSelected.bind(Object(m.a)(a));var n=b();return a.state={currentVersion:n,versionList:["latest",n]},a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"fetchVersionList",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t,a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/VERSIONS");case 3:return t=e.sent,e.next=6,t.text();case 6:a=e.sent,(n=a.split("\n").filter((function(e){return""!==e.trim()}))).sort(y),this.setState({versionList:n}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn("Unable to fetch the version list.");case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.fetchVersionList()}},{key:"onVersionSelected",value:function(e){var t=e.target.value;e.target&&1===e.target.selectedIndex?window.location.pathname="/stable":window.location.pathname="latest"===t?"/latest":"/v".concat(t)}},{key:"render",value:function(){return n.createElement("footer",{className:"footer mt-auto py-3"},n.createElement("div",{className:"footer-container container"},n.createElement("div",{className:"text-muted footer-block"},"By ",n.createElement("a",{href:"https://vilja.me"},"Vilja")," @ ",n.createElement("a",{href:"https://github.com/commoon"},"Commoon Labs"),".\xa0"),n.createElement("div",{className:"text-muted footer-block"},"Source code on ",n.createElement("a",{href:"https://github.com/ryukina/airglow"},"GitHub"),".\xa0"),n.createElement("div",{className:"footer-block"},n.createElement("span",{className:"text-muted"},"Version: "),n.createElement("select",{className:"custom-select custom-select-sm",value:this.state.currentVersion,onChange:this.onVersionSelectedHandler},this.state.versionList.map((function(e,t){return n.createElement("option",{key:t,value:e},e+(1===t?" (stable)":""))}))))))}}]),t}(n.Component),S=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).canvases={encoded:n.createRef(),original:n.createRef(),secret:n.createRef()},a.onDismissAlert=a.dismissAlert.bind(Object(m.a)(a)),a.onLogger=a.logger.bind(Object(m.a)(a)),a.onEncode=a.encode.bind(Object(m.a)(a)),a.onDecode=a.decode.bind(Object(m.a)(a)),a.logging=null,a.isWorking=!1,a.state={alertType:null,formData:{alpha:1,nWatermarks:1,secretKey:""},images:{encoded:null,original:null,secret:null},progress:0,status:""},window.app=Object(m.a)(a),a}return Object(d.a)(t,e),Object(h.a)(t,null,[{key:"clearCanvas",value:function(e){e.width=10,e.height=10,e.getContext("2d").clearRect(0,0,10,10)}}]),Object(h.a)(t,[{key:"dismissAlert",value:function(){this.setState({alertType:null,status:""})}},{key:"updateImage",value:function(e,t){var a=this.state.images;a[e]=t,this.setState({images:a})}},{key:"onChangeFile",value:function(e){var a=this;return function(n){var r=a.canvases[e].current;if(null!==r){t.clearCanvas(r);var i=n.target,o=i.files;if(null===o||o.length<1)a.updateImage(e,null);else{var c=o[0],s=new Image,l=new FileReader;s.onload=function(){r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),a.updateImage(e,s)},l.onloadend=function(){null!==l.result&&(s.src=l.result.toString())},l.readAsDataURL(c),i.value=""}}}}},{key:"logger",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"primary";return new Promise((function(r){a.logging=function(){r()},a.setState({alertType:n,progress:e,status:t})}))}},{key:"componentDidUpdate",value:function(){if(null!==this.logging){var e=this.logging;this.logging=null,setTimeout(e,300)}}},{key:"onDownload",value:function(e){var t=this;return function(a){a.preventDefault();var n=t.state.images[e];if(null!==n){var r=document.createElement("a");r.href=n.src,r.download="encoded.png",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}},{key:"encode",value:function(){var e=Object(c.a)(o.a.mark((function e(a){var n,r,i,c,s,l,u,m,h,d,g,f,p,v,w=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),!this.isWorking){e.next=3;break}return e.abrupt("return");case 3:this.isWorking=!0,n=this.state.formData,r=n.secretKey,i=n.alpha,c=n.nWatermarks,s={},l=0,u=["original","secret"];case 7:if(!(l<u.length)){e.next=18;break}if(m=u[l],h=m,d=this.canvases[h].current.getContext("2d"),null!==(g=this.state.images[h])){e.next=14;break}return e.abrupt("return");case 14:s[h]=d.getImageData(0,0,g.width,g.height);case 15:l++,e.next=7;break;case 18:return f=this.canvases.encoded.current,t.clearCanvas(f),e.prev=20,e.next=23,N(s.original,s.secret,r,c,i/100,this.onLogger);case 23:p=e.sent,f.width=p.width,f.height=p.height,f.getContext("2d").putImageData(p,0,0),(v=document.createElement("img")).onload=function(){return w.updateImage("encoded",v)},v.src=f.toDataURL("image/png"),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(20),this.setState({alertType:"danger",status:e.t0.message});case 36:this.isWorking=!1;case 37:case"end":return e.stop()}}),e,this,[[20,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var e=Object(c.a)(o.a.mark((function e(a){var n,r,i,c,s,l,u,m,h,d,g,f,p,v=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),!this.isWorking){e.next=3;break}return e.abrupt("return");case 3:this.isWorking=!0,n=this.state.formData,r=n.alpha,i=n.secretKey,c={},s=0,l=["original","encoded"];case 7:if(!(s<l.length)){e.next=18;break}if(u=l[s],m=u,h=this.canvases[m].current.getContext("2d"),null!==(d=this.state.images[m])){e.next=14;break}return e.abrupt("return");case 14:c[m]=h.getImageData(0,0,d.width,d.height);case 15:s++,e.next=7;break;case 18:return g=this.canvases.secret.current,t.clearCanvas(g),e.prev=20,e.next=23,j(c.original,c.encoded,i,r/100,this.onLogger);case 23:f=e.sent,g.width=f.width,g.height=f.height,g.getContext("2d").putImageData(f,0,0),(p=document.createElement("img")).onload=function(){return v.updateImage("secret",p)},p.src=g.toDataURL("image/png"),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(20),this.setState({alertType:"danger",status:e.t0.message});case 36:this.isWorking=!1;case 37:case"end":return e.stop()}}),e,this,[[20,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,a=this.state,r=a.alertType,i=a.formData,o=a.images,c=a.progress,s=a.status,l=null===o.original||null===o.secret||""===i.secretKey.trim(),u=null===o.encoded||null===o.original||""===i.secretKey.trim(),m=(e=o.original,t=o.secret,null===e||null===t?0:Math.floor(e.height/2/t.height)*Math.floor(e.width/t.width));return n.createElement("div",{className:"App"},n.createElement("form",{className:"airglow-form container-fluid"},n.createElement("h1",null,"Airglow (",b(),")"),n.createElement("div",{className:"alert alert-dismissible fade show"+(null!==r?" alert-".concat(r):""),role:"alert",style:{display:null===r?"none":"block"}},s,n.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:this.onDismissAlert},n.createElement("span",{"aria-hidden":"true"},"\xd7"))),n.createElement("div",{className:"airglow-progress progress"},n.createElement("div",{className:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"".concat(c,"%")}})),n.createElement("div",{className:"row"},n.createElement("div",{className:"col-12 col-lg-4 container"},n.createElement("div",{className:"form-group"},n.createElement("div",{className:"airglow-canvas-container"},n.createElement("canvas",{className:"airglow-canvas",width:10,height:10,ref:this.canvases.secret})),n.createElement("div",{className:"airglow-file input-group"},n.createElement("div",{className:"input-group-prepend"},n.createElement("span",{className:"input-group-text"},"Secret Image")),n.createElement("div",{className:"custom-file"},n.createElement("input",{type:"file",className:"custom-file-input",onChange:this.onChangeFile("secret")}),n.createElement("label",{className:"custom-file-label",htmlFor:"inputGroupSecretImage"},null===o.secret?"":"".concat(o.secret.width,"*").concat(o.secret.height))))),n.createElement("div",{className:"form-group input-group"},n.createElement("div",{className:"input-group-prepend"},n.createElement("label",{className:"input-group-text",htmlFor:"forNWatermarks"},"Number of Watermarks")),n.createElement("input",{type:"number",className:"form-control",id:"forNWatermarks",min:1,max:m,value:i.nWatermarks,onChange:this.onChangeFormData("nWatermarks")}))),n.createElement("div",{className:"col-12 col-lg-4 container"},n.createElement("div",{className:"form-group"},n.createElement("div",{className:"airglow-canvas-container"},n.createElement("canvas",{className:"airglow-canvas",width:10,height:10,ref:this.canvases.original})),n.createElement("div",{className:"airglow-file form-group input-group"},n.createElement("div",{className:"input-group-prepend"},n.createElement("span",{className:"input-group-text"},"Original Image")),n.createElement("div",{className:"custom-file"},n.createElement("input",{type:"file",className:"custom-file-input",onChange:this.onChangeFile("original")}),n.createElement("label",{className:"custom-file-label",htmlFor:"inputGroupOriginalImage"},null===o.original?"":"".concat(o.original.width,"*").concat(o.original.height))))),n.createElement("div",{className:"form-group"},n.createElement("div",{className:"input-group"},n.createElement("div",{className:"input-group-prepend"},n.createElement("label",{className:"input-group-text",htmlFor:"formSecretKey"},"Secret Key")),n.createElement("input",{type:"text",className:"form-control",id:"formSecretKey",value:i.secretKey,onChange:this.onChangeFormData("secretKey")})),n.createElement("small",{className:"form-text text-muted"},"A secret key used to encrypt the data.")),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"forAlpha"},"Alpha: ",i.alpha/100),n.createElement("input",{type:"range",className:"custom-range",id:"forAlpha",min:1,max:100,value:i.alpha,onChange:this.onChangeFormData("alpha")})),n.createElement("div",{className:"airglow-buttons form-group"},n.createElement("button",{className:"airglow-button btn btn-primary",disabled:l,onClick:this.onEncode},"Encode!"),n.createElement("button",{className:"airglow-button btn btn-primary",disabled:u,onClick:this.onDecode},"Decode!"))),n.createElement("div",{className:"col-12 col-lg-4 container"},n.createElement("div",{className:"form-group"},n.createElement("div",{className:"airglow-canvas-container"},n.createElement("canvas",{className:"airglow-canvas",width:10,height:10,ref:this.canvases.encoded})),n.createElement("div",{className:"airglow-file input-group"},n.createElement("div",{className:"input-group-prepend"},n.createElement("span",{className:"input-group-text"},"Encoded Image")),n.createElement("div",{className:"custom-file"},n.createElement("input",{type:"file",className:"custom-file-input",onChange:this.onChangeFile("encoded")}),n.createElement("label",{className:"custom-file-label",htmlFor:"inputGroupEncodedImage"},null===o.encoded?"":"".concat(o.encoded.width,"*").concat(o.encoded.height))))),n.createElement("div",{className:"airglow-buttons form-group"},n.createElement("button",{className:"airglow-button btn btn-primary",disabled:null===o.encoded,onClick:this.onDownload("encoded")},"Download"))))),n.createElement(D,null))}},{key:"onChangeFormData",value:function(e){var t=this;return function(a){var n=t.state.formData;n[e]=a.target.value,t.setState({formData:n})}}}]),t}(n.Component),I=(a(41),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function F(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}r.render(n.createElement(S,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/v0.1.0",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/v0.1.0","/service-worker.js");I?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):F(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):F(e)}))}}()}},[[26,1,2]]]);
//# sourceMappingURL=main.ee67f599.chunk.js.map