(this.webpackJsonpairglow=this.webpackJsonpairglow||[]).push([[0],{19:function(e,t,n){},20:function(e,t,n){},22:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),c=n(3),i=n(1),s=n.n(i),o=n(10),l=n.n(o),u=(n(19),n(5)),d=n(8),f=n(4),h=(n(9),function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}),v=function(){var e="1.1.0",t=window.location.pathname.split("/");if(t.length>1){var n=t[1];if("dev"===n)return n;if(n.startsWith("v")){var r=n.slice(1);if(!e.startsWith(r))return"???"}}return e},m=function(e,t){if("dev"===e)return-1;if("dev"===t)return 1;for(var n=/^(\d+)\.(\d+)\.(\d+)$/,r=n.exec(e)||["0","0","0","0"],a=n.exec(t)||["0","0","0","0"],c=0,i=[1,2,3];c<i.length;c++){var s=i[c],o=parseInt(r[s],10),l=parseInt(a[s],10);if(o>l)return-1;if(o<l)return 1}return 0},b=function(e){var t=e.getContext("2d");if(!t)throw new Error("No 2D context.");return t};function g(e){if(null===e.secret||null===e.original||null===e.encoded)throw new Error("Check null failed")}var p=function(e,t){var n=t.size(),r=n.width,a=n.height;e.width=r,e.height=a,cv.imshow(e.id,t),t.delete();var c=new Image(r,a);return c.src=e.toDataURL("image/png"),c},j=(n(20),n(0)),x=function(e){var t=Object(i.useState)(null),n=Object(f.a)(t,2),r=n[0],s=n[1],o=Object(i.useRef)(null),l=function(t){null!==t&&(t.width=10,t.height=10,b(t).clearRect(0,0,10,10),s(null),e.onImageChanged(null))},u=e.onCanvasSet;Object(i.useEffect)((function(){return u(o.current)}),[u,o]);var d=function(){var t=Object(c.a)(a.a.mark((function t(n){var r,c,i,u,d;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==(r=o.current)){t.next=3;break}return t.abrupt("return");case 3:if(l(r),!(null===(c=n.target.files)||c.length<1)){t.next=8;break}return s(null),t.abrupt("return");case 8:i=c[0],u=new Image,d=new FileReader,u.onload=function(){var t=u.width,n=u.height;r.width=t,r.height=n;var a=b(r);e.disallowTransparency&&(a.beginPath(),a.fillStyle="black",a.fillRect(0,0,t,n)),a.drawImage(u,0,0),s(u),e.onImageChanged(u)},d.onloadend=function(){null!==d.result&&(u.src=d.result.toString())},d.readAsDataURL(i),n.target.value="";case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=e.name.split(/\s/).join("-"),v="file-".concat(h),m=Object(i.useRef)(null);return Object(j.jsxs)("div",{className:"airglow-image-canvas input-group",children:[Object(j.jsx)("div",{className:"airglow-canvas-container mb-3",children:Object(j.jsx)("canvas",{className:"airglow-canvas",width:10,height:10,ref:o,id:"canvas-".concat(h)})}),Object(j.jsxs)("div",{className:"airglow-file input-group mb-3",children:[Object(j.jsx)("label",{className:"input-group-text",htmlFor:v,children:e.name}),Object(j.jsx)("input",{id:v,type:"file",className:"form-control",onChange:d,ref:m,disabled:e.disabled}),Object(j.jsx)("div",{className:"form-control",onClick:function(){var e=m.current;null!==e&&e.click()},children:null===r?"":"".concat(r.width,"*").concat(r.height)}),Object(j.jsx)("button",{className:"input-group-text",onClick:function(e){e.preventDefault(),l(o.current)},children:"Clear"})]})]})},w=(n(22),n(11)),O=function(e){return Array.from({length:3}).forEach((function(t,n){return e[n].delete()}))},y=function(e){var t=cv.getOptimalDFTSize(e.rows),n=cv.getOptimalDFTSize(e.cols),r=new cv.Mat,a=cv.Scalar.all(0);cv.copyMakeBorder(e,r,0,t-e.rows,0,n-e.cols,cv.BORDER_CONSTANT,a);var c=new cv.Mat;r.convertTo(c,cv.CV_32F);var i=new cv.MatVector,s=new cv.Mat,o=cv.Mat.zeros(r.rows,r.cols,cv.CV_32F);return i.push_back(c),i.push_back(o),cv.merge(i,s),cv.dft(s,s),r.delete(),c.delete(),o.delete(),i.delete(),s},k=function(e){var t=new cv.Mat;cv.dft(e,t,cv.DFT_SCALE|cv.DFT_INVERSE);var n=new cv.MatVector;cv.split(t,n);var r=n.get(0);return n.delete(),r},N=function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new cv.MatVector,cv.split(t,n),r=Array.from({length:3}).map((function(e,t){return y(n.get(t))})),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r,c,i,s,o,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new cv.MatVector,r=Object(w.a)(t);try{for(r.s();!(c=r.n()).done;)i=c.value,s=k(i),n.push_back(s),s.delete()}catch(a){r.e(a)}finally{r.f()}return o=new cv.Mat,l=new cv.Mat,cv.merge(n,o),o.convertTo(l,cv.CV_8UC4),cv.cvtColor(l,l,cv.COLOR_RGB2RGBA),n.delete(),o.delete(),e.abrupt("return",l);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=n(12),S=n(13),I=4294967296,E=function(){function e(t){Object(M.a)(this,e),this.s={a:0,b:0,c:0,d:0},this.setState(t)}return Object(S.a)(e,[{key:"setState",value:function(t){if(void 0===t||"object"!==typeof t){var n=[e.makeSeed(t)];t={a:e.splitMix32(n),b:e.splitMix32(n),c:e.splitMix32(n),d:e.splitMix32(n)}}this.s=t}},{key:"getState",value:function(){return this.s}},{key:"getPermutation",value:function(e){for(var t=Array.from({length:e},(function(e,t){return t}));e>1;){e-=1;var n=Math.floor(this.random()*e);h(t,e,n)}return t}},{key:"random",value:function(){var e=this.s,t=e.b<<9,n=5*e.a;return n=9*(n<<7|n>>>25),e.c^=e.a,e.d^=e.b,e.b^=e.c,e.a^=e.d,e.c^=t,e.d=e.d<<11|e.d>>>21,(n>>>0)/I}}],[{key:"hashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t%=I}return t}},{key:"makeSeed",value:function(t){return"number"===typeof t?t%I:"string"===typeof t?e.hashCode(t)%I:Date.now()%I}},{key:"splitMix32",value:function(e){e[0]=(e[0]+2654435769)%I;var t=e[0];return((t=3266489909*((t=2246822507*(t^t>>>16)%I)^t>>>13)%I)^t>>>16)%I}}]),e}(),D=function(e,t){var n=Math.floor(e.data.length/4),r=t.getPermutation(Math.floor(n/2)),a=cv.Mat.zeros(e.rows,e.cols,e.type());return r.forEach((function(t,r){for(var c=0;c<4;++c)a.data[4*r+c]=e.data[4*t+c],a.data[4*(n-1-r)+c]=e.data[4*t+c]})),a},R=function(e,t,n,r){var a=Math.floor(t.rows/2/n.cols),c=Math.floor(t.cols/n.cols),i=e.channels();if(0===a||0===c)throw new Error("Secret image is too large: use an image whose width <= ".concat(t.cols," and")+" height <= ".concat(Math.floor(t.rows/2)));for(var s=n.size(),o=s.width,l=s.height,u=0;u<a;++u)for(var d=0;d<c;++d){if((r-=1)<0)return;for(var f=0;f<l;++f)for(var h=0;h<o;++h)for(var v=e.ucharPtr(u*l+f,d*o+h),m=n.ucharPtr(f,h),b=0;b<i;++b)v[b]=m[b]}},A=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=e.size(),c=a.width,i=a.height,s=cv.Mat.zeros(i,c,t.type()),o=new cv.Mat,l=new cv.Size(3,3);cv.GaussianBlur(t,o,l,0,0),R(s,e,o,r);var u=D(s,n);return o.delete(),s.delete(),u},F=function(e,t,n){return e.map((function(e,r){var a=new cv.Mat;return cv.addWeighted(t[r],n.alpha,e,1,0,a),a}))},z=function(e,t,n){return e.map((function(e,r){var a=new cv.Mat;return cv.addWeighted(t[r],1,e,-1,0,a),cv.addWeighted(a,1/n.alpha,a,0,0,a),a}))},T=function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var c,i,s,o,l,u,d,f,h,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(0,"Initializing");case 2:if(""!==(c=r.secretKey.trim())){e.next=5;break}throw new Error("Secret key cannot be empty");case 5:return g(t),i=cv.imread(t.original.id),s=cv.imread(t.secret.id),e.next=10,n(5,"Making watermarks");case 10:return o=new E(c),l=A(i,s,o,r.numWatermarks),e.next=14,n(20,"Calculating the frequency domain of original image");case 14:return e.next=16,N(i);case 16:return u=e.sent,e.next=19,n(40,"Calculating the frequency domain of watermarks");case 19:return e.next=21,N(l);case 21:return d=e.sent,e.next=24,n(60,"Calculating the frequency domain of encoded image");case 24:return f=F(u,d,r),e.next=27,n(80,"Calculating the resulting image");case 27:return e.next=29,C(f);case 29:return h=e.sent,v=p(t.encoded,h),e.next=33,n(100,"Finished!","success");case 33:return l.delete(),O(u),O(d),O(f),e.abrupt("return",v);case 38:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),V=function(e,t){var n=Math.floor(e.data.length/4),r=t.getPermutation(Math.floor(n/2)),a=cv.Mat.zeros(e.rows,e.cols,e.type());return r.forEach((function(t,r){for(var c=0;c<4;++c)a.data[4*t+c]=e.data[4*r+c],a.data[4*(n-1-t)+c]=e.data[4*(n-1-r)+c]})),a},_=function(e,t){var n=new cv.Mat;return cv.resize(e,n,t.size()),n},W=function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var c,i,s,o,l,u,d,f,h,v,m;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(0,"Initializing");case 2:if(""!==(c=r.secretKey.trim())){e.next=5;break}throw new Error("Secret key cannot be empty");case 5:return g(t),i=cv.imread(t.original.id),s=cv.imread(t.encoded.id),e.next=10,n(5,"Calculating the frequency domain of original image");case 10:return e.next=12,N(i);case 12:return o=e.sent,e.next=15,n(20,"Scaling the encoded image");case 15:return l=_(s,i),e.next=18,n(30,"Calculating the frequency domain of encoded image");case 18:return e.next=20,N(l);case 20:return u=e.sent,e.next=23,n(45,"Calculating the frequency domain of watermarks");case 23:return d=z(o,u,r),e.next=26,n(60,"Calculating the watermarks image");case 26:return e.next=28,C(d);case 28:return f=e.sent,e.next=31,n(80,"Calculating the resulting image");case 31:return h=new E(c),v=V(f,h),m=p(t.secret,v),e.next=36,n(100,"Finished!","success");case 36:return O(o),O(d),O(u),l.delete(),f.delete(),e.abrupt("return",m);case 42:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),P={encoded:null,original:null,secret:null},q=function(e){return function(t){P[e]=t}},B=null,L=function(){var e=Object(i.useState)({type:null,message:""}),t=Object(f.a)(e,2),n=t[0],r=t[1],s=Object(i.useState)(0),o=Object(f.a)(s,2),l=o[0],h=o[1];Object(i.useEffect)((function(){if(null!==B){var e=B;B=null,setTimeout(e,300)}}));var v=function(e,t,n,a){return new Promise((function(c){"danger"===n?console.error(void 0===a?t:a):console.log("".concat(e,": ").concat(t)),B=c,null!==e&&h(e),r({type:void 0===n?"primary":n,message:t})}))},m=Object(i.useState)({encoded:null,original:null,secret:null}),b=Object(f.a)(m,2),g=b[0],p=b[1],w=function(e){return function(t){return p(Object(d.a)(Object(d.a)({},g),{},Object(u.a)({},e,t)))}},O=Object(i.useState)(1),y=Object(f.a)(O,2),k=y[0],N=y[1],C=Object(i.useState)("Airglow"),M=Object(f.a)(C,2),S=M[0],I=M[1],E=Object(i.useState)(.05),D=Object(f.a)(E,2),R=D[0],A=D[1],F=Object(i.useState)(!1),z=Object(f.a)(F,2),V=z[0],_=z[1],L=Object(i.useMemo)((function(){return e=g.original,t=g.secret,null===e||null===t?0:Math.floor(e.height/2/t.height)*Math.floor(e.width/t.width);var e,t}),[g]),U=Object(i.useMemo)((function(){return null!==g.secret&&null!==g.original&&k<=L&&S.length>0}),[g,k,L,S]),G=Object(i.useMemo)((function(){return null!==g.encoded&&null!==g.original&&S.length>0}),[g,S]),K=function(e){return function(){var t=Object(c.a)(a.a.mark((function t(n){var r,c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),!V&&!Object.keys(P).some((function(e){return null===P[e]}))){t.next=3;break}return t.abrupt("return");case 3:return _(!0),r={numWatermarks:k,secretKey:S,alpha:R},t.prev=5,t.next=8,(e?T:W)(P,v,r);case 8:c=t.sent,w(e?"encoded":"secret")(c),t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(5),i=t.t0,t.next=17,v(null,i.message,"danger",i.stack);case 17:_(!1);case 18:case"end":return t.stop()}}),t,null,[[5,12]])})));return function(e){return t.apply(this,arguments)}}()};return Object(j.jsxs)("div",{className:"airglow-main container-fluid",children:[Object(j.jsxs)("div",{className:"alert alert-dismissible fade show"+(null!==n.type?" alert-".concat(n.type):""),role:"alert",style:{display:null===n.type?"none":"block"},children:[n.message,Object(j.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"alert","aria-label":"Close",onClick:function(){r({type:null,message:""})}})]}),Object(j.jsx)("div",{className:"airglow-progress progress mb-3",children:Object(j.jsx)("div",{className:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"".concat(l,"%")}})}),Object(j.jsxs)("form",{className:"airglow-form",children:[Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-12 col-lg-4",children:[Object(j.jsx)(x,{name:"Secret Image",disabled:V,onCanvasSet:q("secret"),onImageChanged:w("secret"),disallowTransparency:!0}),Object(j.jsxs)("div",{className:"input-group mb-3",children:[Object(j.jsx)("span",{className:"input-group-text",children:"Number of Watermarks"}),Object(j.jsx)("input",{type:"number",className:"form-control",required:!0,min:1,max:L,value:k,disabled:V,onChange:function(e){var t=parseInt(e.target.value);Number.isNaN(t)||N(t=t>L?L:t<1?1:t)}})]})]}),Object(j.jsxs)("div",{className:"col-12 col-lg-4",children:[Object(j.jsx)(x,{name:"Original Image",disabled:V,onCanvasSet:q("original"),onImageChanged:w("original")}),Object(j.jsxs)("div",{className:"input-group mb-3",children:[Object(j.jsx)("span",{className:"input-group-text",children:"Secret Key"}),Object(j.jsx)("input",{type:"text",className:"form-control",required:!0,value:S,disabled:V,onChange:function(e){I(e.target.value)}}),Object(j.jsx)("div",{className:"airglow-help-text form-text",children:"A secret key used to encrypt the data."})]})]}),Object(j.jsxs)("div",{className:"col-12 col-lg-4",children:[Object(j.jsx)(x,{name:"Encoded Image",disabled:V,onCanvasSet:q("encoded"),onImageChanged:w("encoded")}),Object(j.jsx)("div",{className:"airglow-buttons input-group mb-3",children:Object(j.jsx)("button",{className:"airglow-button btn btn-primary",onClick:function(e){e.preventDefault();var t=P.encoded;null!==t&&function(e,t){var n=document.createElement("a");n.href=e.toDataURL("image/png"),n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(t,"encoded.png")},disabled:null===g.encoded,children:"Download"})})]})]}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-12 col-lg-4",children:Object(j.jsxs)("div",{className:"input-group mb-3",children:[Object(j.jsxs)("label",{htmlFor:"inputAlpha",className:"form-label",children:["Alpha",": ",R]}),Object(j.jsx)("input",{type:"range",className:"form-range",min:"1",max:"100",id:"inputAlpha",value:100*R,disabled:V,onChange:function(e){A(parseInt(e.target.value)/100)}})]})}),Object(j.jsx)("div",{className:"col-12 col-lg-4",children:Object(j.jsxs)("div",{className:"airglow-buttons input-group mt-3",children:[Object(j.jsx)("button",{className:"airglow-button btn btn-primary",disabled:V||!U,onClick:K(!0),children:"Encode!"}),Object(j.jsx)("button",{className:"airglow-button btn btn-primary",disabled:V||!G,onClick:K(!1),children:"Decode!"})]})}),Object(j.jsx)("div",{className:"col-12 col-lg-4",children:Object(j.jsx)("div",{className:"airglow-buttons input-group mt-3",children:Object(j.jsx)("a",{className:"airglow-button btn btn-primary",href:"https://github.com/ryukina/airglow",target:"_blank",rel:"noreferrer",children:"Docs"})})})]})]})]})},U=(n(23),function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return e.prev=2,e.next=5,fetch("/VERSIONS");case 5:return t=e.sent,e.next=8,t.text();case 8:return n=e.sent,r=n.split("\n").filter((function(e){return""!==e.trim()})).map((function(e){return e.startsWith("v")?e.slice(1):e})).sort(m),c=r.filter((function(e,t){return t<2||!e.startsWith(r[t-1].split(".").slice(0,-1).join("."))})),e.abrupt("return",c);case 14:e.prev=14,e.t0=e.catch(2),console.warn("Unable to fetch the version list.");case 17:return e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(){return e.apply(this,arguments)}}()),G=function(){var e=v(),t=Object(i.useState)(["dev",e]),n=Object(f.a)(t,2),r=n[0],a=n[1];return U().then((function(e){null!==e&&a(e)})),Object(j.jsx)("footer",{className:"footer mt-auto py-3",children:Object(j.jsxs)("div",{className:"footer-container container",children:[Object(j.jsxs)("div",{className:"text-muted footer-block",children:["By ",Object(j.jsx)("a",{href:"https://vilja.me",children:"Vilja"})," @ ",Object(j.jsx)("a",{href:"https://github.com/commoon",children:"Commoon Labs"}),".\xa0"]}),Object(j.jsxs)("div",{className:"text-muted footer-block",children:["Source code on ",Object(j.jsx)("a",{href:"https://github.com/ryukina/airglow",children:"GitHub"}),".\xa0"]}),Object(j.jsxs)("div",{className:"footer-block",children:[Object(j.jsx)("span",{className:"text-muted",children:"Version: "}),Object(j.jsx)("select",{className:"form-select form-select-sm",value:e,onChange:function(e){var t=e.target.value;e.target&&1===e.target.selectedIndex?window.location.pathname="/stable":window.location.pathname="dev"===t?"/dev":"/v".concat(t)},children:r.map((function(e,t){return Object(j.jsx)("option",{value:e,children:e+(1===t?" (stable)":"")},t)}))})]})]})})};n(24);var K=function(){return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsxs)("h1",{children:["Airglow (",v(),")"]}),Object(j.jsx)(L,{}),Object(j.jsx)(G,{})]})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};window.onOpenCVReady=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete window.onOpenCVReady,l.a.render(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(K,{})}),document.getElementById("root")),J();case 3:case"end":return e.stop()}}),e)})))}},[[25,1,2]]]);
//# sourceMappingURL=main.c6831884.chunk.js.map